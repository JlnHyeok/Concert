# 인덱스(Index) 최적화 보고서 - 인덱스란?

## 1. 인덱스란?

- 인덱스는 데이터베이스에서 데이터를 빠르게 검색할 수 있도록 도와주는 데이터 구조. 인덱스를 사용하면 테이블에 대한 쿼리 성능을 향상시킬 수 있으며, 데이터 조회 시간을 줄여줌. 인덱스는 마치 책의 **목차**와 같아서 필요한 데이터를 빠르게 찾을 수 있도록 도와준다.

## 2. 인덱스 종류

### 2.1. 기본 인덱스

- 기본적으로 데이터베이스는 테이블의 기본 키(Primary Key)와 고유 제약 조건(Unique Constraint)에 대해 인덱스를 자동으로 생성. 이러한 인덱스는 해당 컬럼에 대한 데이터 중복을 방지하고, 빠른 검색을 가능하게 한다.

### 2.2. 복합 인덱스 (Composite Index)

- 복합 인덱스는 두 개 이상의 컬럼을 결합하여 만든 인덱스이다. 여러 조건을 동시에 검색할 때 유리함. 예를 들어, `name`과 `location` 컬럼을 결합하여 복합 인덱스를 생성하면 `name`과 `location`을 동시에 조건으로 검색할 때 성능이 최적화된다.

예시:

#### SQL

```sql
CREATE INDEX idx_concert_name_location ON Concert (name, location);
```

#### TYPEORM

```ts
@Entity()
@Index('IDX_CONCERT_NAME_LOCATION', ['name', 'location']) // 복합 인덱스 설정
export class Concert {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;

  @Column()
  location: string;
}
```

### 2.3. 단일 인덱스 (Single Index)

- 단일 인덱스는 하나의 컬럼에 대해 생성된 인덱스. 주로 자주 조회되는 컬럼에 대해 생성함. `location` 컬럼만 검색할 때는 단일 인덱스가 유리하다.

예시:

```sql
CREATE INDEX idx_concert_location ON Concert (location);
```

#### TYPEORM

```ts
@Entity()
export class Concert {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  @Index() // 단일 컬럼 인덱스
  name: string;

  @Column()
  location: string;
}
```

### 2.4. 유니크 인덱스 (Unique Index)

- 유니크 인덱스는 컬럼의 값이 고유해야 할 때 생성하는 인덱스. 기본 키와 유사하지만, 유니크 제약 조건이 있는 컬럼에만 적용됩니다. 유니크 인덱스는 중복 데이터가 존재하지 않도록 보장함.

## 3. 인덱스가 중요한 이유

- 인덱스는 데이터를 검색하는 데 중요한 역할을 한다. 테이블에서 검색이 빠를수록 애플리케이션의 성능도 향상됨. 인덱스의 주요 역할은 다음과 같다.

1. **빠른 조회**: 인덱스를 사용하면 테이블에 대해 빠르게 검색할 수 있음. 예를 들어, 데이터가 많을수록 인덱스를 활용하여 성능을 향상시킬 수 있다.
2. **정렬 최적화**: `ORDER BY` 쿼리를 사용할 때 인덱스가 있으면 정렬이 더 빨라진다.
3. **집계 함수 최적화**: `GROUP BY`, `COUNT`, `SUM` 등의 집계 함수를 사용할 때도 인덱스가 도움이 될 수 있다.

## 4. 인덱스가 성능에 미치는 영향

### 4.1. 읽기 성능 향상

- 인덱스는 **조회 성능을 크게 향상**시킬 수 있다. 인덱스가 있으면 테이블을 순차적으로 탐색하지 않고, 인덱스를 사용하여 더 빠르게 데이터를 찾을 수 있다.

### 4.2. 쓰기 성능 저하

- 하지만, 인덱스는 **쓰기 성능에 부정적인 영향을** 미친다. 데이터가 추가되거나 수정될 때마다 해당 인덱스를 갱신해야 하기 때문. 즉, 인덱스를 많이 추가할수록 **INSERT, UPDATE, DELETE** 쿼리가 느려질 수 있다.

### 4.3. 저장 공간 증가

- 인덱스는 별도의 저장 공간을 차지한다. 인덱스가 많으면 그만큼 디스크 공간을 더 많이 사용하게 되므로, 인덱스 개수를 적절히 관리하는 것이 중요하다.

## 5. 인덱스 사용 시 고려사항

### 5.1. 조회 패턴에 맞는 인덱스 설정

- 인덱스를 설정할 때는 **주로 사용되는 조회 패턴**을 분석하는 것이 중요하다. 예를 들어, `name`과 `location`을 동시에 조건으로 자주 검색한다면 `(name, location)` 복합 인덱스를 설정하는 것이 좋다. 반면, `location`만 검색할 일이 많다면 `location`에 단일 인덱스를 추가하는 것이 유리하다.

### 5.2. 쓰기 성능 고려

- 쓰기 작업이 많은 테이블에 대해서는 인덱스를 최소화하는 것이 좋다. 불필요한 인덱스를 제거하고, **주요 컬럼에만 인덱스를 설정**하는 것이 성능을 개선하는 방법.

### 5.3. 인덱스의 적절한 관리

- 데이터베이스의 성능을 지속적으로 모니터링하고, **불필요한 인덱스를 제거**하거나, **필요한 인덱스를 추가**하는 방식으로 성능 최적화를 진행해야 함.

## 6. 인덱스 최적화 전략

### 6.1. 최소한의 인덱스 유지

- 읽기 성능을 높이기 위해서는 자주 조회되는 컬럼에 대해서만 인덱스를 설정. 과도한 인덱스 추가는 쓰기 성능을 저하시킬 수 있으므로, 필요한 인덱스를 최소화해야 한다.

### 6.2. 대량 데이터 삽입 시 인덱스 비활성화

- 대량 데이터를 삽입해야 할 경우, 인덱스를 비활성화하고 삽입 후 다시 활성화하는 방법을 사용할 수 있음. 이는 쓰기 성능을 높이는 데 유용하다.

### 6.3. 정기적인 인덱스 재정리

- PostgreSQL에서 제공하는 `VACUUM` 명령어를 사용하여 인덱스와 테이블을 정리하고 성능을 유지하는 것이 중요하다.

## 7. 요약

- 인덱스는 데이터베이스의 성능을 최적화하는 데 매우 중요한 역할을 하지만 인덱스를 과도하게 설정하면 **쓰기 성능 저하**와 **저장 공간 증가** 등의 부작용이 발생할 수 있다. 따라서 **조회 성능 향상과 쓰기 성능 간의 균형**을 잘 맞추는 것이 중요하다. 인덱스를 설정할 때는 애플리케이션의 조회 패턴을 분석하고, 필요에 따라 복합 인덱스나 단일 인덱스를 설정하는 것이 좋다.
