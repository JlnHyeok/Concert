# 서버 동시 요청 처리 성능 개선 보고서

---

## 1. 개요

2024년 11월 28일, 동시 요청 처리 성능 테스트에서 서버 과부하로 인한 장애 상황이 발생하였습니다. 본 보고서는 문제의 원인과 이를 개선하기 위해 적용된 해결 방안을 설명하고, 최종적으로 얻은 개선 결과를 정리합니다.

---

## 2. 문제 사항

### **문제 현상**

- K6 부하 테스트 도구를 사용하여 동시 요청 시나리오를 실행한 결과, 서버가 **429 Too Many Requests** 오류를 반환하며 정상적인 요청 처리가 불가능한 상황이 발생했습니다.
- 테스트 중 서버는 요청 처리 한계를 초과하여 응답 지연과 자원 부족 문제로 장애를 일으켰습니다.

### **원인 분석**

1. **서버 메모리 부족**

   - 서버 실행 시 Node.js 기본 메모리 설정(2GB)이 과도한 요청 부하를 처리하기에 충분하지 않았습니다.

2. **동시 요청 제한 부재**
   - 요청을 제어하는 시스템이 없어, 모든 요청이 동시에 처리되면서 CPU와 메모리 사용량이 급증하였습니다.

---

## 3. 개선 방안

### 1. **Node.js 메모리 증설**

- 서버 실행 시 메모리 기본 값을 2GB에서 4GB로 증설하여, 대량의 동시 요청 처리 시 안정성을 확보하였습니다.

### 2. **ThrottlerModule 적용**

- NestJS의 **ThrottlerModule**을 도입하여 서버에 대한 요청 제한을 설정하였습니다.
  - 요청을 IP별로 제한하여, 클라이언트가 초당 과도한 요청을 보내는 상황을 방지.
  - 429 Too Many Requests 에러 발생 시 요청을 효율적으로 거절하며 서버 자원 사용률을 안정화.

#### 적용 방법:

- `ThrottlerModule.forRoot()`를 사용하여 글로벌 요청 제한 정책을 설정.
- `limit` 및 `ttl` 값을 조정하여 특정 시간 내 허용되는 요청 수를 제한.

---

## 4. 결과

### **성능 개선**

- 메모리 증설과 ThrottlerModule 적용 후, K6 테스트에서 **429 Too Many Requests 발생 빈도 감소** 및 서버 안정성 확보.

#### 테스트 결과:

- **기존:** 1,000 RPS (초당 요청 수)에서 서버 과부하 발생.
- **개선 후:** 1,500 RPS에서도 정상 동작.

### **추가 효과**

- 비정상적인 요청으로부터 서버를 보호하여 DDoS와 같은 문제에 대한 대응력을 강화.
- 요청 제한 에러(429)를 클라이언트에 명확히 전달함으로써 클라이언트 측에서 요청 속도를 조정할 수 있는 환경을 제공.

---

## 5. 향후 계획

1. **요청 제한 정책 세분화**

   - 엔드포인트별 요청 제한 설정을 통해 특정 API의 부하를 분산할 계획입니다.

2. **실시간 모니터링 강화**

   - ThrottlerModule의 요청 제한 로그를 분석하여 추가 최적화 방안을 마련할 예정입니다.

3. **스케일 아웃 검토**
   - 서버 자원의 추가 증설 및 로드 밸런싱 설정 최적화를 통해 높은 트래픽 상황에 유연하게 대응하도록 설계할 예정입니다.

---

## 6. 결론

K6 부하 테스트를 통해 발견된 문제를 기반으로, **메모리 증설**과 **ThrottlerModule** 적용을 통해 서버 과부하 문제를 해결하였습니다. 이를 통해 동시 요청 처리 성능과 서버 안정성을 향상시켰으며, 향후 유사한 장애를 예방할 수 있는 기반을 마련했습니다.
